<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookBuddy ‚Äî Donate</title>

  <!-- fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>
<body data-page="donate">
  <div class="page-wrap">
    <div class="site">

      <header>
        <div style="display:flex;align-items:center;gap:12px">
          <div class="logo" aria-hidden="true">
            <svg viewBox="0 0 100 80" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="6" y="8" width="22" height="62" rx="3" fill="#d9443f"/>
              <rect x="36" y="8" width="22" height="62" rx="3" fill="#d9443f" opacity="0.95"/>
            </svg>
            <h1>BookBuddy</h1>
          </div>
        </div>

        <nav class="top-nav" aria-label="Main navigation">
          <a href="#" data-route="home" class="nav-link">Home</a>
          <a href="#" data-route="buy" class="nav-link">Buy</a>
          <a href="#" data-route="sell" class="nav-link">Sell</a>
          <a href="#" data-route="donate" class="nav-link">Donate</a>
          <a href="#" id="loginNavBtn">Login / Sign up</a>
        </nav>
      </header>

      <!-- HERO -->
      <section class="hero page" id="homePage">
        <h2 id="hero-heading">Every Book Deserves<br>a Second Reader.</h2>

        <div class="search-wrap" style="max-width:900px;margin:0 auto 8px;">
          <input id="globalSearch" class="search-input" placeholder="Search books, authors, publishers or users..." />
          <button class="search-btn" id="searchBtn">Search</button>
        </div>

        <div class="cta-row" role="group" aria-label="Calls to action">
          <button class="primary-btn" data-route="buy">Buy Books</button>
          <button class="primary-btn" data-route="sell">Sell Your Book</button>
          <button class="primary-btn" data-route="donate">Donate</button>
        </div>

        <div style="max-width:900px;margin:0 auto;text-align:center">
          <p style="color:var(--muted);margin:0 0 12px">Search or browse books below. Click a book to chat with the seller.</p>
        </div>

        <h3 class="section-title">Explore Books</h3>

        <div id="homeGrid" class="grid" aria-live="polite"></div>
      </section>

      <!-- BUY PAGE -->
      <section class="page" id="buyPage" aria-hidden="true">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 class="section-title">Buy Books</h3>
          <div style="color:var(--muted);font-size:14px">Showing available books</div>
        </div>

        <div id="buyGrid" class="grid"></div>
      </section>

      <!-- SELL PAGE -->
      <section class="page" id="sellPage" aria-hidden="true">
        <h3 class="section-title">Sell a Book</h3>
        <div class="form" style="max-width:760px">
          <div class="field">
            <label>Book Title</label>
            <input id="sellTitle" placeholder="E.g., The Alchemist" />
          </div>
          <div class="two-col">
            <div class="field">
              <label>Author</label>
              <input id="sellAuthor" placeholder="Author name" />
            </div>
            <div class="field">
              <label>Publisher</label>
              <input id="sellPublisher" placeholder="Publisher" />
            </div>
          </div>
          <div class="two-col">
            <div class="field">
              <label>Price (‚Çπ)</label>
              <input id="sellPrice" type="number" placeholder="e.g., 350" />
            </div>
            <div class="field">
              <label>Condition</label>
              <select id="sellCondition">
                <option>New</option>
                <option>Used - Like New</option>
                <option>Used - Good</option>
                <option>Used - Acceptable</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label>Cover Image URL (optional)</label>
            <input id="sellImage" placeholder="Paste an image URL or leave blank for template image" />
          </div>

          <div style="display:flex;gap:10px;margin-top:8px">
            <button class="primary-btn" id="postListingBtn">Post Listing</button>
            <button class="secondary-btn" id="clearSell">Clear</button>
          </div>

          <p style="color:var(--muted);font-size:13px;margin-top:10px">You must be logged in to post. If not logged in you will be prompted to login/signup.</p>
        </div>
      </section>

      <!-- DONATE PAGE -->
      <section class="page active" id="donatePage" aria-hidden="false">
        <h3 class="section-title">Donate Books</h3>
        <div class="form" style="max-width:760px">
          <div class="field">
            <label>Book Title</label>
            <input id="donateTitle" placeholder="E.g., The Little Prince" />
          </div>
          <div class="field">
            <label>Author / Publisher</label>
            <input id="donateMeta" placeholder="Author or Publisher name" />
          </div>
          <div class="field">
            <label>Pickup Location (optional)</label>
            <input id="donateLocation" placeholder="City, area" />
          </div>
          <div style="display:flex;gap:10px;margin-top:8px">
            <button class="primary-btn" id="postDonateBtn">Post Donation</button>
          </div>
          <p style="color:var(--muted);font-size:13px;margin-top:10px">Donations are posted as free listings for others to claim.</p>
        </div>

        <hr style="margin: 30px 0; border: none; border-top: 1px solid #ccc;">
        <h3 class="section-title">Available Donations</h3>
        <div id="donation-list" class="donation-grid"></div>
      </section>

      <!-- LOGIN / SIGNUP MODAL -->
      <div id="authModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" style="max-width:480px;height:auto;">
        <div class="modal-header">
          <div style="font-weight:700">Login / Sign up</div>
          <div><button class="secondary-btn" id="closeAuth">Close</button></div>
        </div>

        <div style="padding:12px; display:grid; gap:10px">
          <div id="authForm">
            <div class="field"><label>Email</label><input id="authEmail" placeholder="you@example.com" /></div>
            <div class="field"><label>Username</label><input id="authUser" placeholder="choose a username" /></div>
            <div class="field"><label>Password</label><input id="authPass" type="password" placeholder="password" /></div>

            <div style="display:flex;gap:8px">
              <button class="primary-btn" id="signupBtn">Create account</button>
              <button class="secondary-btn" id="loginExistingBtn">Login</button>
            </div>

          </div>
        </div>
      </div>

      <!-- CHAT MODAL -->
      <div id="chatModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
        <div class="modal-header">
          <div id="chatTitle">Chat</div>
          <div><button class="secondary-btn" id="closeChat">Close</button></div>
        </div>
        <div class="messages" id="messagesArea" aria-live="polite"></div>
        <div class="chat-input">
          <input id="chatInput" placeholder="Write your message..." />
          <button id="sendChatBtn">Send</button>
        </div>
      </div>

      <div class="floating-chat">
        <button id="openChats">Chats</button>
      </div>

    </div>
  </div>

  <script src="script.js" defer></script>

  <!-- üìö Added Donation Script -->
  <script>
  async function loadDonations() {
    try {
      const res = await fetch('/api/donations');
      const donations = await res.json();
      const list = document.getElementById('donation-list');
      list.innerHTML = '';

      if (!donations.length) {
        list.innerHTML = '<p style="color:gray;">No donations yet. Be the first to donate!</p>';
        return;
      }

      donations.forEach(d => {
        const card = document.createElement('div');
        card.className = 'donation-card';
        card.innerHTML = `
          <img src="${d.image || 'https://picsum.photos/200'}" alt="${d.title}">
          <h4>${d.title}</h4>
          <p>${d.meta || 'Unknown Author/Publisher'}</p>
          <p><strong>üìç ${d.location || 'N/A'}</strong></p>
          <p><em>Donor: ${d.donor || 'Anonymous'}</em></p>
        `;
        list.appendChild(card);
      });
    } catch (err) {
      console.error('Error loading donations:', err);
    }
  }

  document.getElementById('postDonateBtn').addEventListener('click', async () => {
    const title = document.getElementById('donateTitle').value.trim();
    const meta = document.getElementById('donateMeta').value.trim();
    const location = document.getElementById('donateLocation').value.trim();

    if (!title) return alert('Please enter a book title');

    const res = await fetch('/api/donations', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, meta, location })
    });

    const data = await res.json();
    if (data.success) {
      alert('Donation posted successfully!');
      document.getElementById('donateTitle').value = '';
      document.getElementById('donateMeta').value = '';
      document.getElementById('donateLocation').value = '';
      loadDonations();
    } else {
      alert('Error posting donation.');
    }
  });

  document.addEventListener('DOMContentLoaded', loadDonations);
  </script>
</body>
</html>
